# 📋 需求文档

## 🎯 项目概述

**Excel 文件管理系统** - 一个基于 Web 的应用，采用**青春活泼设计风格**，支持用户认证、文件上传、存储、查看和下载，用户间数据完全隔离。

![Excel Expert](https://img.shields.io/badge/Excel-管理专家-brightgreen?style=for-the-badge&logo=microsoft-excel)
![Vue](https://img.shields.io/badge/Vue-3-4FC08D?style=for-the-badge&logo=vue.js)
![FastAPI](https://img.shields.io/badge/FastAPI-009688?style=for-the-badge&logo=fastapi)

---

## 📝 原始需求

做一个应用，将上传的 Excel 保存到数据库，然后可以通过 web 选择文件进行显示。通过 Docker 和侧载的方式部署应用，数据库使用 MySQL。

## 🚀 功能需求

### 🔐 认证功能

#### 1. **👤 用户注册**
- 📝 用户名注册（3-50个字符）
- 📧 邮箱验证
- 🔑 密码最小长度6位
- ✅ 注册后自动登录

#### 2. **🔐 用户登录**
- 🪪 用户名/密码登录
- 🔐 Session + Cookie 认证
- ⏰ Session 有效期24小时
- 🔄 登录后清除旧会话

#### 3. **👋 用户登出**
- 🗑️ 清除服务端会话
- 🧹 清除客户端状态
- 🔄 重定向到登录页

#### 4. **🔒 数据隔离**
- 🛡️ 用户只能访问自己的文件
- 🔐 所有 API 请求需要认证
- 📁 文件上传关联当前用户
- 🖼️ 图片下载验证用户权限

### 🎯 核心功能

#### 5. **📤 文件上传**
- ✅ 支持 .xls 和 .xlsx 格式
- 🎯 拖拽或点击上传
- 📏 文件大小限制：50MB
- 📊 显示上传进度
- 👤 文件关联当前用户

#### 6. **💾 文件存储**
- 🗄️ 原始文件二进制存储（用于下载）
- 📋 解析数据结构化存储（用于展示）
- 🗑️ 支持级联删除
- 🔒 用户级数据隔离

#### 7. **👀 数据展示**
- 📊 表格形式展示 Excel 数据
- 📄 支持多 Sheet 切换
- 📑 支持分页浏览
- 🔄 支持全量加载
- 👤 仅显示当前用户的文件

#### 8. **📁 文件管理**
- 📄 文件列表展示（仅当前用户）
- 📥 文件下载（原始文件）
- 🗑️ 文件删除（仅当前用户的文件）

### 🎨 高级功能

#### 9. **🔄 合并单元格支持**
- 🔍 正确解析 Excel 中的合并单元格
- 🎯 前端正确渲染合并效果（colspan/rowspan）
- ✨ 合并单元格渐变高亮显示

#### 10. **🖼️ 内嵌图片支持**
- 📸 提取 Excel 中的内嵌图片
- 🗂️ 图片存储到数据库
- 🖼️ 前端展示图片缩略图
- 🔍 点击预览大图
- 📍 显示图片锚定位置

#### 11. **📈 内嵌图表支持**
- 📊 识别 Excel 中的图表类型
- 🏷️ 提取图表标题和位置信息
- 📋 前端展示图表元信息

#### 12. **📋 多表格区域支持**
- 🔍 自动检测单个 Sheet 内的多个表格（通过空行分隔）
- 🔄 支持切换查看不同表格区域
- 🏷️ 自动识别表格名称

## ⚙️ 技术需求

### 🛠 技术栈

| 层级 | 技术 | 特性 |
|------|------|------|
| 🎨 前端 | Vue 3 + Vite + Element Plus + Pinia | 响应式、组件化、状态管理 |
| ⚡ 后端 | Python + FastAPI + SQLAlchemy + Passlib | 异步、ORM、认证 |
| 🗄️ 数据库 | MySQL 8.0 | 关系型、事务支持 |
| 🐳 部署 | Docker + Docker Compose | 容器化、编排管理 |
| 🔐 认证 | Session + Cookie + bcrypt | 安全、会话管理 |

### 🚀 部署需求

#### 1. **🐳 Docker 部署**
- 📦 使用 Docker Compose 编排服务
- 🎯 支持一键启动
- 🔄 支持服务重启和扩展

#### 2. **📦 侧载部署**
- 💾 支持导出 Docker 镜像
- 🚫 支持离线环境部署
- 📤 支持镜像传输和导入

---

## 💾 数据库设计

### 📊 数据表结构

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| 👤 users | 用户信息 | id, username, email, password_hash, created_at |
| 🎫 sessions | 用户会话 | id, session_id, user_id, expires_at |
| 📁 excel_files | Excel 文件信息 | id, filename, original_data, user_id, upload_time |
| 📄 excel_sheets | Sheet 信息 | id, file_id, sheet_name, row_count, column_count |
| 📝 excel_data | 单元格数据 | id, sheet_id, row, column, value |
| 🔗 merged_cells | 合并单元格 | id, sheet_id, start_row, start_col, end_row, end_col |
| 🖼️ sheet_images | 内嵌图片 | id, sheet_id, image_data, image_format, anchor_row, anchor_col |
| 📈 sheet_charts | 内嵌图表 | id, sheet_id, chart_type, chart_title, chart_data, anchor_row, anchor_col |
| 🗂️ table_regions | 表格区域 | id, sheet_id, region_index, start_row, end_row, table_name |

### 🔄 关系设计

```
users 1 ←→ N excel_files 1 ←→ N excel_sheets 1 ←→ N excel_data
  ↓                                          ↓
sessions                                  merged_cells
                                          ↓
                                       sheet_images
                                       sheet_charts
                                       table_regions
```

---

## 🔌 API 设计

### 🔐 认证 API

| 方法 | 路径 | 说明 | 请求体 | 响应 |
|------|------|------|--------|------|
| POST | /api/auth/register | 用户注册 | `{username, email, password}` | `{token, user}` |
| POST | /api/auth/login | 用户登录 | `{username, password}` | `{token, user}` |
| POST | /api/auth/logout | 用户登出 | - | `{message}` |
| GET | /api/auth/me | 获取用户信息 | - | `{user}` |

### 📁 文件 API（需要认证）

| 方法 | 路径 | 说明 | 参数 | 响应 |
|------|------|------|------|------|
| POST | /api/upload | 上传文件 | file: Excel文件 | `{file}` |
| GET | /api/files | 获取文件列表 | page, page_size | `{files, total}` |
| GET | /api/files/{id} | 获取文件详情 | - | `{file}` |
| GET | /api/files/{id}/sheets/{sheet_id}/data | 获取Sheet数据 | page, page_size, region_index | `{data, merged_cells, images, charts}` |
| GET | /api/files/{id}/download | 下载文件 | - | 文件流 |
| GET | /api/images/{image_id} | 获取图片 | - | 图片流 |
| DELETE | /api/files/{id} | 删除文件 | - | `{message}` |

---

## 📊 功能支持矩阵

| 特性 | .xlsx | .xls | 说明 |
|------|-------|------|------|
| 📊 单元格数据 | ✅ | ✅ | 支持读取所有单元格数据 |
| 🔄 合并单元格 | ✅ | ✅ | 正确解析和渲染合并效果 |
| 🖼️ 内嵌图片 | ✅ | ❌ | .xls 格式不支持图片提取 |
| 📈 内嵌图表 | ✅ (元信息) | ❌ | 仅显示图表类型和位置 |
| 📋 多表格区域 | ✅ | ✅ | 通过空行自动检测分割 |
| 🌐 中文文件名 | ✅ | ✅ | 使用 RFC 5987 编码 |
| 🔐 用户隔离 | ✅ | ✅ | 完整的用户权限控制 |

---

## 🎨 界面设计规范

### 🌈 视觉风格

- **主题色调**：青春活力的蓝紫渐变 (#667EEA → #F093FB) + 粉橙渐变 (#FA8BFF → #2BD2FF)
- **设计元素**：圆角、渐变、玻璃拟态、阴影层次
- **动画效果**：悬停变换、过渡动画、微交互
- **图标风格**：简约线性图标，配合渐变色彩

### 📱 响应式设计

- **桌面端**：完整功能，表格展示优化
- **移动端**：简化操作，触摸友好
- **平板端**：平衡布局，适配屏幕

---

## 🔄 版本历史

### 🚀 v3.0 (当前版本)
- 🆕 新增用户认证系统
- 🔐 新增用户注册/登录/登出功能
- 🛡️ 新增用户间数据隔离
- 🔒 所有 API 需要认证
- 🍪 Session + Cookie 认证机制
- 🔐 bcrypt 密码加密
- 📦 新增用户状态管理（Pinia）
- 🎨 新增青春活泼主题设计

### 📈 v2.0
- 🆕 新增合并单元格支持
- 🖼️ 新增内嵌图片提取和展示
- 📊 新增内嵌图表识别
- 📋 新增多表格区域检测
- 🔄 重构前端表格组件
- 🎯 优化数据渲染性能

### 🎯 v1.0
- 📤 基础文件上传/下载/删除
- 📊 数据表格展示
- 📄 多 Sheet 支持
- 📑 分页浏览功能
- 🐳 Docker 部署支持

---

## 📋 待实现功能

### 🔮 规划中

- [ ] 🌐 **多语言支持** - 国际化 (i18n)
- [ ] 📊 **数据导出** - 支持 CSV、PDF 导出
- [ ] 🔍 **全文搜索** - 文件内容搜索
- [ ] 📈 **数据可视化** - 图表渲染展示
- [ ] 👥 **用户管理** - 管理员面板
- [ ] 📊 **使用统计** - 文件上传统计
- [ ] 🔄 **自动备份** - 数据定期备份
- [ ] 🔗 **API 限流** - 接口访问控制

### 🐛 已知问题

- [ ] .xls 格式不支持内嵌图片提取
- [ ] 图表仅展示元信息，无法渲染
- [ ] 大文件分页性能优化
- [ ] 移动端表格滚动体验

---

## 📞 联系方式

如有问题或建议，请联系开发团队：

- 📧 Email: dev@excelexpert.com
- 💬 Issues: [GitHub Issues](https://github.com/excelexpert/issues)
- 🌐 Website: https://excelexpert.com

---

<div align="center">
  <p>
    <strong>Excel 管理专家 - 让数据处理更简单</strong>
  </p>
  <p>
    Made with ❤️ by Excel 管理专家团队
  </p>
  <p>
    <a href="#功能需求">🚀 功能</a> •
    <a href="#技术需求">⚙️ 技术</a> •
    <a href="#api设计">🔌 API</a> •
    <a href="#版本历史">📝 版本</a>
  </p>
</div>